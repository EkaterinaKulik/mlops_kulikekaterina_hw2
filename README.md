# Домашнее задание 2

## Описание проекта

Сервис реализует потоковый скоринг транзакций для задачи классификации мошенничества. Он принимает сообщения с данными транзакций из Kafka-топика transactions, выполняет препроцессинг и прогнозирование предобученной моделью CatBoost, после чего публикует результаты, скор и флаг фрода, в Kafka-топик scores.

Дополнительно реализован сервис записи результатов в базу PostgreSQL, а также интерфейс на Streamlit, который позволяет просматривать последние записи с флагом fraud_flag == 1 и визуализировать распределение скоринговых оценок.

Модель не хранится напрямую в репозитории и автоматически загружается из GitHub Release при сборке Docker-образа.

## Архитектура решения

Компоненты системы:
1. ```bash fraud_detector (ML Service) ```
   
   Основной сервис, реализующий потоковый скоринг транзакций.

	- Загружает предобученную модель CatBoost из GitHub Release.
	- Выполняет препроцессинг данных.
	- Применяет модель для предсказания вероятности мошенничества и вычисляет флаг фрода по заданному порогу.
	- Отправляет результаты скоринга в Kafka-топик scores.
  
3. ```bash scores-writer (Storage Service) ```
  - Получает сообщения из Kafka-топика scores.
  - Записывает поступающие данные в таблицу scores базы данных PostgreSQL.
  - Формирует витрину для дальнейшего анализа и визуализации.

3.  ```bash interface (Streamlit UI) ```
   
Интерактивный пользовательский интерфейс для просмотра результатов скоринга.
   - Подключается к PostgreSQL и отображает 10 последних транзакций с флагом fraud_flag == 1.
   - Строит гистограмму распределения скоров последних 100 транзакций.
   - Используется для визуального контроля корректности работы системы и мониторинга вероятных случаев фрода.

4.  ```bash Kafka Infrastructure ```
   - Zookeeper + Kafka брокер
   - kafka-setup: автоматически создает топики transactions и scoring
   - Kafka UI: веб-интерфейс для мониторинга сообщений (порт 8080)
     
5. ```bash PostgreSQL ```
   
   - 	Таблица scores содержит идентификатор транзакции, значение скора и флаг фрода.
   - 	Используется сервисом interface для визуализации данных.

## Быстрый старт

### Требования

- Docker 20.10+
- Docker Compose 2.0+

### Запуск сервиса

 ```bash 
git clone https://github.com/<your_username>/fraud-detection-system.git
cd fraud-detection-system

# Сборка и запуск всех сервисов
docker-compose up --build
```

После запуска:

Streamlit UI: http://localhost:8501
Kafka UI: http://localhost:8080
Логи сервисов:
 ```bash 
docker-compose logs <service_name>  # Например: fraud_detector, kafka, interface
```

## Использование

1. Загрузите CSV через интерфейс Streamlit. Для тестирования работы проекта используется файл формата test.csv из соревнования https://www.kaggle.com/competitions/teta-ml-1-2025
2. Мониторинг:
- Kafka UI: просматривайте сообщения в топиках transactions и scores.
- Логи обработки: /app/logs/service.log внутри контейнера fraud_detector.
- PostgreSQL: проверьте таблицу scores — в ней сохраняются результаты скоринга, записанные сервисом scores-writer.
3. Результаты:
Скоринговые оценки и флаг фрода публикуются в топик scores в формате:
 ```bash 
{
  "score": 0.995,
  "fraud_flag": 1,
  "transaction_id": "d6b0f7a0-8e1a-4a3c-9b2d-5c8f9d1e2f3a"
}
```
## Структура проекта
 ```bash 
.
├── docker-compose.yml                
├── README.md                         

├── fraud_detector/                    
│   ├── app/                           
│   │   └── app.py                    
│   ├── src/
│   │   ├── preprocessing.py           
│   │   └── scorer.py                 
│   ├── models/
│   │   └── features.txt              
│   ├── requirements.txt              
│   └── Dockerfile                   

├── scores-writer/                     
│   ├── app.py                        
│   ├── requirements.txt               
│   └── Dockerfile                     

├── interface/                       
│   ├── app.py                      
│   ├── requirements.txt               
│   └── Dockerfile                  

```

## Настройки Kafka

 ```bash 
Топики:
- transactions (входные данные)
- scoring (результаты скоринга)

Репликация: 1 (для разработки)
Партиции: 3
```

Примечание:

Для полной функциональности убедитесь, что:
	1.	Порты 8080 (Kafka UI), 8501 (Streamlit) и 5432 (PostgreSQL) свободны на хосте.
	2.	Docker Compose поднимает контейнеры в одной сети, чтобы сервисы могли обмениваться сообщениями через Kafka.
